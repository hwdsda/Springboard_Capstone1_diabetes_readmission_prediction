---
title: "Milestone Report of Capstone Project 1"
author: "Hongyun Wang"
date: "1/12/2020"

fontsize: 10pt

output: 
  pdf_document:
    toc: true
    toc_depth: 2
    number_sections: true
    keep_tex: no
    fig_caption: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Problem statement
Hospital readmission rate is a good measure for health care quality and cost. Patients with diabetes currently represent about 9% of the US population, but they account for approximately 25% of hospitalizations (over eight million per year). The 30-day readmission rate of diabetic patients is 14.4-22.7%, which is higher than that of all hospitalized patients (8.5-13.5%). The burden of diabetes among hospitalized patients is substantial, growing and costly and readmissions contribute a significant portion of this burden. Therefore, reducing 30-day readmissions of patients with diabetes has the potential to greatly reduce healthcare costs while simultaneously improving care.

After a [paper](https://www.hindawi.com/journals/bmri/2014/781670/) published in 2014 on HbA1c correlation with diabetic patients readmission, the result generated by the paper and the data and statistics used are of great influence and the test is then used widely. In this project, rather than verifying the result generated by the paper, I would like to examine diabetes patients readmission rate using a different approach, classificaion.

# Description of the data set
## Background
The dataset used for this project was acquired from UCI Machine Learning Repository at (https://archive.ics.uci.edu/ml/datasets/Diabetes+130-US+hospitals+for+years+1999-2008)

The dataset used in this study is from the Health Facts database (Cerner Corporation, Kansas City, MO), a national data warehouse that collects comprehensive clinical records across hospitals throughout the United States. Health Facts is a voluntary program offered to organizations which use the Cerner Electronic Health Record System. The database contains data systematically collected from participating institutions electronic medical records and includes encounter data (emergency, outpatient, and inpatient), provider specialty, demographics (age, sex, and race), diagnoses and in-hospital procedures documented by ICD-9-CM codes, laboratory data, pharmacy data, in-hospital mortality, and hospital characteristics. All data were identified in compliance with the Health Insurance Portability and Accountability Act of 1996 before being provided to the investigators. Continuity of patient encounters within the same health system (EHR system) is preserved.

The Health Facts data the study used was an extract representing 10 years (1999–2008) of clinical care at 130 hospitals and integrated delivery networks throughout the United States: Midwest (18 hospitals), Northeast (58), South (28), and West (16). Most of the hospitals (78) have bed size between 100 and 499, 38 hospitals have bed size less than 100, and bed size of 14 hospitals is greater than 500.

The database consists of 41 tables in a fact-dimension schema and a total of 117 features. The database includes 74,036,643 unique encounters (visits) that correspond to 17,880,231 unique patients and 2,889,571 providers. Because this data represents integrated delivery network health systems in addition to stand-alone hospitals, the data contains both inpatient and outpatient data, including emergency department, for the same group of patients. However, data from out-of-network providers is not captured.

## Data wrangling and cleaning
### remove encounters with duplicated patient number and encounters with discharge to a hospice or patient death
The preliminary dataset contained multiple inpatient visits for some patients and the observations could not be considered as statistically independent, an assumption of the logistic regression model. We thus used only one encounter per patient; in particular, we considered only the first encounter for each patient as the primary admission and determined whether or not they were readmitted within 30 days. Additionally, we removed all encounters that resulted in either discharge to a hospice or patient death, to avoid biasing our analysis. After filtering on the encounters, 71,050 rows were left comparing to the initial rows of 101,766.

### Re-label the response variable
The current response variable 'readmitted' has 3 categories: <30, >30 and NO. This study is interested in those patients that are readmitted within 30 days after discharge. Then, the <30 category was coded as 1, other two categories were coded as 0.

###  Check missing values
Check the percentage of missing values for each variable and observation. Three variables have >39% missing values: `weight`, `medical_specialty` and `payer_code`. Other variables have <3% missing values. The variable weight with >50% missing values were dropped. Before dropping variables, the highest percentage of missing values in observations is 10%. This number decreases to 8% after dropping variables. Currently keep the observations with missing values. Three variables, `weight`, `payer_code` and `medical_specialty` were dropped.

### Check outliers (numerical variables)
8 numerical varaibles were checked for outliers. There are no missing values but there are outliers in those 8 variables according to the boxplot of each numerical variable. Currently keep all those outliers in each variable.

### Examine categorical variables
Categorical variables have following types:  
- `race`, `gender`, `age`. Those are basic demographic information.  
- `admission_type_id`, `discharge_disposition_id`, `admission_source_id` are numerical but they are IDs and should be treated as categorical.  
- `diag_1`, `diag_2`, `diag_3` have several hundred distinct values. Those diagnose information are partly captured in numerical variable number_diagnoses.  
- `max_glu_serum`, `A1Cresult`. Special lab test results.  
- 23 generic medications and a special one `diabetesMed`. `change` is a binary variable indicating whether there was a change in diabetic medications (either dosage or generic name).  
- Categorization of diagnoses variables: The dataset contained upto three diagnoses for a given patient (primary, secondary and additional). However, each of these had 700–900 unique ICD codes and it is extremely difficult to include them in the model and interpret meaningfully. Therefore, these diagnosis codes were grouped into 9 disease groups based on the original publication using this dataset. These 9 groups are Circulatory, Respiratory, Digestive, Diabetes, Injury, Musculoskeletal, Genitourinary, Neoplasms, and Others.  
- Create another variable `num_change` number of diabetic medication change. For each encounter, if there are either one Up or one Down in diabetic medications, then there is one diabetic medication change. If thre are diabetic medication's generic name change but no dosage change (Steady), there is another diabetic medication change.

After checking the levels of each categorical variable, variables with only 1 level were droped. They are `citoglipton`, `glimepiride-pioglitazone`, `examide`. After removing duplicated patient numbers, both encounter id and patient number are unique now. Remove patient number and keep encounter id for row identification for later exploratory data analysis. Encounter id won't be included in later data modeling analysis.

### Summary of cleaned dataset
The cleaned data set has 71,050 encounters and 41 variables:  
- 1 unique encounter id  
- 1 response variable  
- 8 numerical variables  
- 34 categorical variables  


# Initial findings from exploratory data analysis
## summary of findings
In primary study (no categorical level combination), 12 categorical variables have significant association with Readmission (*p*-value < 0.01). They are `repaglinide`, `diabetesMed`, `age`, `insulin`, `discharge_disposition_id`, `diag_2`, `diag_1`, `diag_3`, `change`, `metformin`, ` glipizide`and `admission_type_id`. `age`, `discharge_disposition_id`, `admission_type_id` are demorgraphic and admission/discarge realted. diag_2`, `diag_1` and `diag_3` are diagnoses categories completed at encounters. Other 7 variables are all medication related, including medication types and medication changes.

There are 20 diabetic medications that have different levels of results. `insulin`, `metformin`, `glipizide` and `glyburide` are the top four diabetic medications used in encounters.  

`A1cresult `is not signifcant at primary study. The *p*-value is 0.0641 at 0.05 significance level. After combining >7 category and > 8 category to form a High category for `A1Cresult`, the association test generate a *p*-value of 0.033. 

Except two variables `num_procedures` and `number_outpatient` have *p*-values as 0.6626 and 0.0234, other 6 variables have *p*-value close to 0. The differences of mean of those 6 numerical variables between two Readmission categories are significant. 

For 8 numerical variables, there are 28 paris of correlation coefficients. Among those 28 pairs of correlation coefficients, 3 pairs of numerical variables have corrrelation coeffieients greater than 0.3. They are `num_medications` and `time_in_hospital` (*r*=0.47), `num_procedres` and `num_medications` (*r*=0.4), and `num_lab_precedures` and `time_in_hospital` (*r*=0.33).


## visuals and statistics to support findings

![Scatterplot of numerical variables](C:/Users/hw07/Desktop/figures/num_var_scatter.png){width=600px}  

Scatterplot of variables `num_procedures`, `number_diagnoses`, `num_medications`,`num_lab_procedures`. Those four numerical variables are about how many procedures/diagnoses/medications have been given and they are in similar scales.

![Scatterplot of numerical variables](C:/Users/hw07/Desktop/figures/num_var_scatter2.png){width=600px}  

Scatterplot of variables `number_outpatient`, `number_inpatient`, `number_emergency`, `num_lab_procedures`. Those three numerical variables are about different type of clinic/hospital visits in the year precdeing the encounter and they are in similar scales.
<center>
![Boxplot of numerical variables by Readmission](C:/Users/hw07/Desktop/figures/num_var_boxplot.png){width=600px}  
</center>
![Stripplot of numerical variables (visits preceding enrounters)](C:/Users/hw07/Desktop/figures/num_var_boxplot1.png){width=600px}  
Readmissions tend to be associated with low number_emergency and number_outpatient. Those readmissions have longer time in hospital then those without readmissions. Then it suggests that the longer time stay (between 1 day and 14 days) in hospital, the more chance to have readmission.  

![A1c barplot](C:/Users/hw07/Desktop/figures/A1c_barplot.png){width=300px} 
![glucose serum barplot](C:/Users/hw07/Desktop/figures/glucose_serum_barplot.png){width=300px} 
![Frequency of diabetic mediction usage](C:/Users/hw07/Desktop/figures/diab_med_freq.png){width=600px} 


![medication change and diabetes medication](C:/Users/hw07/Desktop/figures/change_diab_med.png){width=600px} 
![medication change and diabetes medication](C:/Users/hw07/Desktop/figures/diab_med.png){width=600px} 







